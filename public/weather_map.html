<!DOCTYPE html>
<html>
<head>
	<title>Weather API Excercise</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/css/custom_weather.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBe-7WVZBaOd-46Cro9q74z7znqq8mk9do"></script>

</head>
<body>
	<div class="well col-md-12">
	<h1>Weather Application</h1>
		<h2 class="weatherTitle"></h2>
			<h3 id='weatherLocation'></h3>
		
		<div class="row">
			<div id="day_0_weather" class="weather col-md-4">
				<p class="temperature"></p>
				<p class="weatherIcon"></p>
				<p class="main"><span id="boldMain"></span></p>
				<p class="humidity"></p>
				<p class="pressure"></p>
			</div>

			<div id="day_1_weather" class="weather col-md-4">
				<h3 class="weatherTitle"></h3>
				<p class="temperature"></p>
				<p class="weatherIcon"></p>
				<p class="main"><span id="boldMain"></span></p>
				<p class="humidity"></p>
				<p class="pressure"></p>
			</div>

			<div id="day_2_weather" class="weather col-md-4">
				<h3 class="weatherTitle"></h3>
				<p class="temperature"></p>
				<p class="weatherIcon"></p>
				<p class="main"><span id="boldMain"></span></p>
				<p class="humidity"></p>
				<p class="pressure"></p>
			</div>

		</div>

		<div class="map">
			<button id="mapRefresh">Refresh Map</button>
			<div id="map-canvas"></div>
		</div>

<script>
"use strict";
(function () {
	$(document).ready(function () {
		// 3 day weather forecast portion
		var ajaxRequest = $.get("http://api.openweathermap.org/data/2.5/forecast/daily", {
		    APPID: 	"bb2f96092c9145d0fde92b0fde206791",
		    q:     	'Alamo Heights, TX',
		    units: 	"imperial",
		    cnt: 3
		}).done(function (object) {
				var arrayLength = object.list				
				var weatherLocation = object.city.name; // look at possible removal..just use loop
			    $('#weatherLocation').append(weatherLocation);
				for(var i = 0; i < (arrayLength.length); i++) {
					var temperature = '<p class="temperature">' 
						+ Math.round(object.list[i].temp.max) 
						+ " / " + Math.round(object.list[i].temp.min) + '</p>';
					var weatherIcon = '<p><img src="http://openweathermap.org/img/w/' 
						+ object.list[i].weather[0].icon + '.png"' + '</p>';
					var main = '<p><span id="boldMain">' + object.list[i].weather[0].main 
						+ '</span>: ' + object.list[i].weather[0].description + '</p>';							
					var humidity = '<p>' + object.list[i].humidity + '</p>';
					var pressure = '<p>' + object.list[i].pressure + '</p>';
					var htmlString = temperature + weatherIcon + main 
						+ humidity + pressure + '</br>';
						console.log(htmlString);
						$('#day_' + i + '_weather').html(htmlString); 
			};				
		    console.log("Mission Accomplished!")
			ajaxRequest.always(function (){
				console.log("request sent")
			});
			ajaxRequest.fail(function (object, error){
				console.log(error);
				console.log(ajaxRequest.status)
			});
		});
	// Google Map Portion
		var address = '2611 Eisenhauer Rd, San Antonio TX 78209';
		var geocoder = new google.maps.Geocoder();
		var marker;
		// function initialize () {
		// 	var mapOptions = {
		// 	      zoom: 3,
		// 	      center: { lat: 29.430000, lng: -98.492435 }
		// 	    }
	 //    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
		// };
		// google.maps.event.addDomListener(window, 'load', initialize);
		
		$('#mapRefresh').click(function (e) {
			e.preventDefault;
			geocoder.geocode( { 'address': address}, function(results, status) {
			console.log(results);
				if (status == google.maps.GeocoderStatus.OK) {
					var mapOptions = {
				      zoom: 3,
				      center: { lat: 29.430000, lng: -98.492435 }
				    }
					console.log(status)
					var infowindow = new google.maps.InfoWindow({
				        content: 'Current Weather Location'
					})
				    var map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
				    var marker = new google.maps.Marker({
				    	position: results[0].geometry.location,
				    	map: map
				    })
				    infowindow.open(map, marker);
				} else {
				alert("Geocoding was not successful - STATUS: " + status);
				}
			})
		});
	});
})();
</script>
</body>
</html>